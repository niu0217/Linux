# 进程调度

## 代码地址

+ https://github.com/niu0217/HGDOS/tree/Note

## 1. kernel/sched.c

### 1.1 schedule函数

![image-20240422211111230](进程调度.assets/image-20240422211111230.png) 

其中switch_to函数的定义：

![image-20240422211629457](进程调度.assets/image-20240422211629457.png) 

### 1.2 sys_pause函数

![image-20240422212123022](进程调度.assets/image-20240422212123022.png) 

### 1.3 sleep_on函数

#### 1.3.1 我的注释

![image-20240423100910506](进程调度.assets/image-20240423100910506.png)  

#### 1.3.2 原注释

![image-20240422214552510](进程调度.assets/image-20240422214552510.png) 

#### 1.3.3 原理图解

![image-20240422214758574](进程调度.assets/image-20240422214758574.png) 

![image-20240422214859912](进程调度.assets/image-20240422214859912.png) 

此时`*p`指向的是等待队列的队首位置。

+ `*tmp`是一个局部变量，所以它存在栈中，哪个栈呢？当前进程的内核栈中；
+ 既然`*tmp`存在于当前进程的内核栈中，那么当前进程当然可以找到`*tmp`；
+ 进程切换的时候，内核栈也会跟着切换。而每个内核栈中都有一个`*tmp`，它指向原等待任务，这不就是一个隐形的链表；

### 1.4 interruptible_sleep_on函数

![image-20240423101048621](进程调度.assets/image-20240423101048621.png) 

### 1.5 wake_up函数

![image-20240423101201320](进程调度.assets/image-20240423101201320.png)  

### 1.6 有用的初始化

![image-20240422221532651](进程调度.assets/image-20240422221532651.png) 



